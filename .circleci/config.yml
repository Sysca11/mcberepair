version: 2.1
orbs:
  codecov: codecov/codecov@1.0.2
  build-tools: circleci/build-tools@2.6.3
workflows:
  build-and-test:
    jobs: 
      - compile
jobs:
  compile:
    docker:
      - image: gcc:8
    steps:
      - checkout
      - run: git submodule sync
      - run: git submodule update --init
      - build-tools/install-ci-tools
      - run:
          name: Updating Packages
          command: 'apt-get update'
      - run:
          name: Installing CMake
          command: 'apt-get install -y cmake'
      - run:
          name: Creating Build Files
          command: 'cmake -S. -Bbuild/circleci -DCMAKE_BUILD_TYPE=Debug -DDEVOPT_ENABLE_COVERAGE_REPORT=On'
      - run:
          name: Building All
          command: 'cmake --build build/circleci -j 2'


#  - codecov/upload:
#          file: {{ coverage_report_filepath }}